# N8N Workflow: Sequential Block Processing for Long Videos

> **–í–µ—Ä—Å–∏—è:** 1.0
> **–î–∞—Ç–∞:** 2025-11-26
> **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ (1+ —á–∞—Å) –ø–æ –±–ª–æ–∫–∞–º —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

---

## üìã –°—Ö–µ–º–∞ workflow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Whisper Transcription Route                                       ‚îÇ
‚îÇ  ‚Üì                                                                  ‚îÇ
‚îÇ  [Parse Whisper Results] (–∫–æ–¥: parse-whisper-results.js)          ‚îÇ
‚îÇ  ‚Üì                                                                  ‚îÇ
‚îÇ  [Prepare for LLM]                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Database Route (–µ—Å–ª–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —É–∂–µ –µ—Å—Ç—å)                       ‚îÇ
‚îÇ  ‚Üì                                                                  ‚îÇ
‚îÇ  [Prepare for LLM from DB]                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ                         ‚îÇ
                 ‚ñº                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [–ù–û–í–ê–Ø –ù–û–î–ê] Split Into Blocks                                    ‚îÇ
‚îÇ  –ö–æ–¥: split-into-blocks.js                                         ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  –í—Ö–æ–¥: {text_llm, words_llm, duration, client_meta}               ‚îÇ
‚îÇ  –í—ã—Ö–æ–¥: –º–∞—Å—Å–∏–≤ –±–ª–æ–∫–æ–≤ [{block_id, main_zone_start, ...}, ...]     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [Loop Over Items] - –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê                    ‚îÇ
‚îÇ  –†–µ–∂–∏–º: "Run Once for Each Item"                                   ‚îÇ
‚îÇ  –ë–∞—Ç—á–∏–Ω–≥: –í–´–ö–õ–Æ–ß–ï–ù (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ –æ–¥–Ω–æ–º—É)                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [AI Agent - Gemini/OpenAI/Claude]                                 ‚îÇ
‚îÇ  –ú–æ–¥–µ–ª—å: Gemini 2.5 Flash                                          ‚îÇ
‚îÇ  maxOutputTokens: 8192                                              ‚îÇ
‚îÇ  –ü—Ä–æ–º–ø—Ç: ai-prompt-block-processing.md                             ‚îÇ
‚îÇ  –í—Ö–æ–¥: —Ç–µ–∫—É—â–∏–π –±–ª–æ–∫ (block_id, text_llm, words_llm, etc.)         ‚îÇ
‚îÇ  –í—ã—Ö–æ–¥: {shorts: [{title, subtitle, start_time, ...}]}            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [Parse AI Response]                                                ‚îÇ
‚îÇ  –ö–æ–¥: parse-ai-response.js                                         ‚îÇ
‚îÇ  –ü–∞—Ä—Å–∏—Ç JSON/Markdown –æ—Ç–≤–µ—Ç                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [Collect All Results]                                              ‚îÇ
‚îÇ  –°–æ–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π Loop                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [–ù–û–í–ê–Ø –ù–û–î–ê] Deduplicate Shorts                                   ‚îÇ
‚îÇ  –ö–æ–¥: deduplicate-shorts.js                                        ‚îÇ
‚îÇ  –£–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—é > 50%                             ‚îÇ
‚îÇ  –°–æ—Ö—Ä–∞–Ω—è–µ—Ç shorts —Å –ª—É—á—à–∏–º virality_score                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [Final Output]                                                     ‚îÇ
‚îÇ  –§–∏–Ω–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö shorts                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–æ–¥

### 1. Split Into Blocks (Code Node)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –¢–∏–ø: Code
- –Ø–∑—ã–∫: JavaScript
- –ö–æ–¥: —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `split-into-blocks.js`

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
{
  "text_llm": "–ø–æ–ª–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –≤–∏–¥–µ–æ...",
  "words_llm": [{w: "—Å–ª–æ–≤–æ", s: 123.5, e: 124.0}, ...],
  "video_duration": 5400,
  "duration": "PT1H30M0S",
  "duration_ms": 5400000,
  "language": "ru",
  "client_meta": {
    "max_blocks": 3,
    "overlap_seconds": 90
  }
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
[
  {
    "block_id": 1,
    "total_blocks": 3,
    "block_start": 0,
    "block_end": 1890,
    "main_zone_start": 0,
    "main_zone_end": 1800,
    "text_llm": "—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –±–ª–æ–∫–∞ 1...",
    "words_llm": [...],
    "video_duration": 5400,
    "duration": "PT1H30M0S",
    "duration_ms": 5400000,
    "language": "ru",
    "client_meta": {...}
  },
  {
    "block_id": 2,
    ...
  },
  {
    "block_id": 3,
    ...
  }
]
```

---

### 2. Loop Over Items

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- **Batch Size:** 1 (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ –æ–¥–Ω–æ–º—É –±–ª–æ–∫—É)
- **Mode:** "Run Once for Each Item"

**–ü–æ—á–µ–º—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –∞ –Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ?**
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å rate limits AI API
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –æ—Ç–ª–∞–¥–∫–∞
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤ (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ)

---

### 3. AI Agent (Gemini/OpenAI/Claude)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Gemini 2.5 Flash:**
```javascript
{
  "model": "gemini-2.0-flash-exp",
  "maxOutputTokens": 8192,  // –í–ê–ñ–ù–û! –ë—ã–ª–æ 2048 - –º–∞–ª–æ
  "temperature": 0.7,
  "systemPrompt": "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ ai-prompt-shorts-extractor.md"
}
```

**User Prompt:**
```javascript
`–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –±–ª–æ–∫ –≤–∏–¥–µ–æ –∏ –Ω–∞–π–¥–∏ 2-5 –°–ê–ú–´–• –í–ò–†–£–°–ù–´–• –º–æ–º–µ–Ω—Ç–æ–≤ –¥–ª—è YouTube Shorts, TikTok –∏ Instagram Reels.

üì¶ –ë–õ–û–ö –ò–ù–§–û–†–ú–ê–¶–ò–Ø:
- Block ID: ${$json.block_id} –∏–∑ ${$json.total_blocks}
- Main Zone: ${Math.round($json.main_zone_start/60)}m ‚Üí ${Math.round($json.main_zone_end/60)}m (‚ö†Ô∏è Shorts –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ù–ê–ß–ò–ù–ê–Æ–¢–°–Ø –∑–¥–µ—Å—å!)
- Block Range: ${Math.round($json.block_start/60)}m ‚Üí ${Math.round($json.block_end/60)}m (overlap –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
- –û–±—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ: ${Math.round($json.video_duration/60)} –º–∏–Ω—É—Ç
- –Ø–∑—ã–∫: ${$json.language}

üìù –¢–†–ê–ù–°–ö–†–ò–ü–¶–ò–Ø (–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –±–ª–æ–∫–∞):
${$json.text_llm}

‚è±Ô∏è WORD-LEVEL TIMESTAMPS (–∞–±—Å–æ–ª—é—Ç–Ω—ã–µ —Ç–∞–π–º–∫–æ–¥—ã):
${JSON.stringify($json.words_llm)}

üéØ –í–•–û–î–ù–û–ô CLIENT_META (—Å–æ—Ö—Ä–∞–Ω–∏ –≤—Å–µ –ø–æ–ª—è!):
${JSON.stringify($json.client_meta || {})}

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. Shorts –û–ë–Ø–ó–ê–ù–´ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è –≤ Main Zone (${$json.main_zone_start}-${$json.main_zone_end} —Å–µ–∫)
2. –ò—Å–ø–æ–ª—å–∑—É–π –ê–ë–°–û–õ–Æ–¢–ù–´–ï —Ç–∞–π–º–∫–æ–¥—ã –∏–∑ words_llm (–Ω–µ –≤—ã—á–∏—Ç–∞–π block_start!)
3. –ú–∞–∫—Å–∏–º—É–º 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ shorts
4. –ú–∏–Ω–∏–º—É–º virality_score: 7.5 (–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–π –Ω–∏–∂–µ!)
5. –ü–µ—Ä–≤—ã–π —Å—É–±—Ç–∏—Ç—Ä –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å start: 0.0
6. –í–µ—Ä–Ω–∏ –ß–ò–°–¢–´–ô JSON (–±–µ–∑ markdown –±–ª–æ–∫–æ–≤ \`\`\`json)
7. –°–æ—Ö—Ä–∞–Ω–∏ –í–°–ï –ø–æ–ª—è –∏–∑ client_meta –∏ –¥–æ–±–∞–≤—å –Ω–æ–≤—ã–µ

üìä –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:
–í–µ—Ä–Ω–∏ 2-5 —Å–∞–º—ã—Ö –≤–∏—Ä—É—Å–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º (YouTube, TikTok, Instagram).
–ö–∞–∂–¥—ã–π shorts –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å virality_score >= 7.5 –∏ –±—ã—Ç—å –≥–æ—Ç–æ–≤ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ –≤—Å–µ—Ö —Ç—Ä—ë—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö.`
```

---

### 4. Parse AI Response (Code Node)

**–ö–æ–¥:** —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `parse-ai-response.js`

–ü–∞—Ä—Å–∏—Ç –æ—Ç–≤–µ—Ç AI –∞–≥–µ–Ω—Ç–∞ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á–∏—Å—Ç—ã–π JSON –∏ markdown –±–ª–æ–∫–∏).

---

### 5. Deduplicate Shorts (Code Node)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –¢–∏–ø: Code
- –Ø–∑—ã–∫: JavaScript
- –ö–æ–¥: —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `deduplicate-shorts.js`

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
–í—Å–µ items –ø–æ—Å–ª–µ Loop (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `$input.all()`)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
{
  "shorts": [
    {
      "start": 850.5,
      "end": 908.2,
      "title": "–õ—É—á—à–∏–π –º–æ–º–µ–Ω—Ç 1",
      "subtitles": [
        {"text": "–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º", "start": 0.0, "end": 1.250},
        {"text": "—Å–µ–≥–æ–¥–Ω—è –ø–æ–∫–∞–∂—É", "start": 1.300, "end": 2.500}
      ],
      "client_meta": {
        ...existing fields from input...,
        "youtube_title": "–õ—É—á—à–∏–π –º–æ–º–µ–Ω—Ç –∏–≥—Ä—ã | –≠–ø–∏—á–Ω–æ #Shorts",
        "youtube_description": "–ü–æ–∫–∞–∑—ã–≤–∞—é –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç...\n\n#gaming #–ª–∞–π—Ñ—Ö–∞–∫",
        "tiktok_title": "–õ—É—á—à–∏–π –º–æ–º–µ–Ω—Ç –∏–≥—Ä—ã",
        "tiktok_description": "–≠—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –ø—Ä–æ—Å—Ç–æ wow üò± –°–æ—Ö—Ä–∞–Ω–∏! –í–∏–¥–µ–ª —Ç–∞–∫–æ–µ? üëá #gaming #–≥–µ–π–º–ø–ª–µ–π #—ç–ø–∏–∫",
        "instagram_description": "–Ø –Ω–µ –æ–∂–∏–¥–∞–ª —á—Ç–æ —Ç–∞–∫ –ø–æ–ª—É—á–∏—Ç—Å—è üò± –í–æ—Ç —ç—Ç–æ –º–æ–º–µ–Ω—Ç! üéÆ\n\n–°–æ—Ö—Ä–∞–Ω–∏ üëá\n\n#gaming #–≥–µ–π–º–ø–ª–µ–π #—ç–ø–∏–∫",
        "duration": "PT58S",
        "duration_ms": 57700,
        "virality_score": 9.5,
        "virality_reason": "–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π wow-–º–æ–º–µ–Ω—Ç —Å –≤—ã—Å–æ–∫–æ–π —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ—Ç–¥–∞—á–µ–π"
      }
    }
  ],
  "stats": {
    "total_before": 12,
    "total_after": 10,
    "duplicates_removed": 2,
    "overlap_threshold": 50
  }
}
```

---

## üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ client_meta –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∞–º–∏

–í –Ω–∞—á–∞–ª—å–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø–µ—Ä–µ–¥–∞–π—Ç–µ:

```json
{
  "client_meta": {
    "max_blocks": 5,           // –ú–∞–∫—Å–∏–º—É–º 5 –±–ª–æ–∫–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)
    "overlap_seconds": 120,     // –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 2 –º–∏–Ω—É—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 90)
    "min_shorts_per_block": 2,  // –ú–∏–Ω–∏–º—É–º shorts –Ω–∞ –±–ª–æ–∫
    "max_shorts_per_block": 5   // –ú–∞–∫—Å–∏–º—É–º shorts –Ω–∞ –±–ª–æ–∫
  }
}
```

**–ü—Ä–∏–º–µ—Ä—ã:**

| –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ | max_blocks | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|-------------------|------------|-----------|
| 25 –º–∏–Ω—É—Ç | 3 | 1 –±–ª–æ–∫ (–∫–æ—Ä–æ—Ç–∫–æ–µ –≤–∏–¥–µ–æ) |
| 45 –º–∏–Ω—É—Ç | 3 | 2 –±–ª–æ–∫–∞ –ø–æ ~22 –º–∏–Ω |
| 90 –º–∏–Ω—É—Ç | 3 | 3 –±–ª–æ–∫–∞ –ø–æ ~30 –º–∏–Ω |
| 180 –º–∏–Ω—É—Ç | 3 | 3 –±–ª–æ–∫–∞ –ø–æ ~60 –º–∏–Ω |
| 180 –º–∏–Ω—É—Ç | 6 | 6 –±–ª–æ–∫–æ–≤ –ø–æ ~30 –º–∏–Ω |

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –±–ª–æ—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –î–æ (—Ü–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞):
- ‚ùå –ü—Ä–æ–º–ø—Ç: 50,219 —Ç–æ–∫–µ–Ω–æ–≤
- ‚ùå –í—ã–≤–æ–¥: –æ–±—Ä–µ–∑–∞–Ω –Ω–∞ 4,373 —Ç–æ–∫–µ–Ω–∞—Ö (MAX_TOKENS)
- ‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–µ–ø–æ–ª–Ω—ã–π JSON, 4 shorts –∏–∑ 15

### –ü–æ—Å–ª–µ (3 –±–ª–æ–∫–∞):
- ‚úÖ –ü—Ä–æ–º–ø—Ç –Ω–∞ –±–ª–æ–∫: ~17,000 —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –í—ã–≤–æ–¥ –Ω–∞ –±–ª–æ–∫: ~3,000 —Ç–æ–∫–µ–Ω–æ–≤ (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞!)
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–ª–Ω—ã–π JSON, 3-4 shorts √ó 3 –±–ª–æ–∫–∞ = 9-12 shorts
- ‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: 8-10 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö shorts

---

## üöÄ –ó–∞–ø—É—Å–∫ workflow

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥** –∏–∑ —Ñ–∞–π–ª–æ–≤ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Code –Ω–æ–¥—ã
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ AI Agent** (–º–æ–¥–µ–ª—å, —Ç–æ–∫–µ–Ω—ã, –ø—Ä–æ–º–ø—Ç)
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Loop** (batch size = 1, sequential mode)
4. **–î–æ–±–∞–≤—å—Ç–µ client_meta** –≤ –Ω–∞—á–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ workflow**

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–æ–≤:

–ü–æ—Å–ª–µ –Ω–æ–¥—ã "Split Into Blocks" –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥:

```javascript
console.log(`–°–æ–∑–¥–∞–Ω–æ –±–ª–æ–∫–æ–≤: ${$json.length}`);
$json.forEach(block => {
  console.log(`Block ${block.block_id}: ${block.main_zone_start}-${block.main_zone_end}`);
});
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:

–ü–æ—Å–ª–µ –Ω–æ–¥—ã "Deduplicate Shorts":

```javascript
console.log(`–î–æ: ${$json.stats.total_before} shorts`);
console.log(`–ü–æ—Å–ª–µ: ${$json.stats.total_after} shorts`);
console.log(`–£–¥–∞–ª–µ–Ω–æ: ${$json.stats.duplicates_removed} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤`);
```

---

## üìù –ó–∞–º–µ—Ç–∫–∏

- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 3 –±–ª–æ–∫–∞ √ó 30 —Å–µ–∫ AI = ~90 —Å–µ–∫—É–Ω–¥ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)
- **–¢–æ–∫–µ–Ω—ã:** —ç–∫–æ–Ω–æ–º–∏—è ~60% –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Ü–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- **–ö–∞—á–µ—Å—Ç–≤–æ:** –ª—É—á—à–µ, —Ç.–∫. AI –≤–∏–¥–∏—Ç –º–µ–Ω—å—à–µ —Ç–µ–∫—Å—Ç–∞ –∏ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å max_blocks –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ (3+ —á–∞—Å–∞)

---

**–°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é [Claude Code](https://claude.com/claude-code)**
